# 0.2.5 “Crafting”

Основные хайлайты
- Новая волна крафта: 15 материалов, 1 эксклюзивная карта из крафта, 1 предмет и 2 темы.
- Прозрачный “Состав удачи” — теперь видно, из чего складывается Luck.
- Дебаг‑панель получила управление материалами.
- Визуальные эффекты: полностью переделан alt‑ERROR и добавлены эффекты для новых карт.
- Баланс: бусты удачи теперь стакаются.

Добавлено
- Материалы (15 шт.) и дроп с поддержкой режимов:
  - applyOn: 'first' | 'duplicate' | 'both' — материалы могут падать и при первом получении карты, и с дублей.
- Рецепты крафта:
  - Новая тема: Shinigami (theme-shinigami).
  - Обсидиановая тема (theme-obsidian) как полноценная тема (см. “Изменено”).
  - 1 craft‑only предмета (только через крафт, в магазине не отображаются):
    - Disco Glasses (+1.5 Luck)
  - Новая craft‑only карта: Scrap Golem (scrap_golem) — единственный источник получения через крафт.
- Новые карты в пуле ролла:
  - Bleached (1/1,200,000, minPrestige 2) — стили и FX.
  - Afro (1/350,000) — стили и FX.
- Состав удачи:
  - Game.getLuckBreakdown(): базовая шина для аналитики удачи.
  - UI: карточка “Состав удачи” вверху вкладки “Статистика” (локализовано ru/en).
  - Показ: Base, Luck Core, Prestige, Blackhole duplicates, Equipment (flat), Misfortune stacks, Sword Path, Boosts + множитель катализатора, Total.
- Дебаг‑панель:
  - Новая секция “Материалы” (без правок HTML — инжектируется из debug.js): выбор материала, +/-/set, автоперерисовка.
- Визуальные эффекты:
  - Полный rework эффекта для alt‑ERROR: интенсивный глитч (RGB‑сдвиг, “срезы”, noise), устойчив без backdrop‑filter.
  - Новые эффекты для Bleached (оранжевые “slashes”) и Afro (неоновый эквалайзер).
  - One‑shot запуск FX для событий:
    - JACKPOT (короткая вспышка),
    - успешный universal_upgrade (глитч).

Изменено
- Удача:
  - Бусты удачи теперь СУММИРУЮТСЯ (ранее брался только самый сильный); катализатор space_alt_2 умножает сумму.
- Магазин:
  - craftOnly‑экипировка полностью скрыта из вкладки Shop (и из блока “Надето” там же), но отображается и управляется в Рюкзаке.
- Тема “Обсидиановая кузня”:
  - Рецепт theme_obsidian_forge теперь выдает тему theme‑obsidian (раньше был плейсхолдер на престиж).
  - Добавлено полное оформление темы: графитовый фон, “раскалённые прожилки”, лавово‑оранжевый акцент.
- Инвентарь:
  - Фикс подбора рамки по редкости: используется id (border-<id>), а не cssClass.

Удалено/Поведение изменено
- Рецепты на alt‑карты убраны из крафта. Alt‑карты теперь только из роллов (как и задумывалось).
- Поддержка craft‑only карт/предметов:
  - Карты с rollable: false (например, Scrap Golem) не попадают в пул ролла — только через крафт.

Локализация
- Добавлены ru/en ключи для:
  - Новых карт (Bleached/Afro, Scrap Golem).
  - Новых материалов/рецептов/предметов/тем.
  - Состава удачи (Luck Breakdown).
  - Дебаг‑панели (материалы).
- Обновлены описания: у craft‑карты и её рецепта разные тексты (отдельно для мастерской и для карточки).

Совместимость сохранений
- SaveManager: расширены статистики (stats.itemsCrafted, stats.materialsCollectedTotal) с безопасной инициализацией по умолчанию. Старые сохранения совместимы.
- Новая логика дропа материалов не ломает старые записи (applyOn имеет дефолт 'duplicate').

Технические детали
- Game.performRoll: добавлен фильтр rollable === false (исключает крафтовые карты).
- Game.processRollResult: переработан дроп материалов под applyOn: 'first'|'duplicate'|'both'.
- Debug: секция материалов инжектируется из debug.js (без правок index.html).
- CSS: стили для .rarity-bleached, .rarity-afro, .rarity-scrap-golem, тема theme‑obsidian.
- VisualEffects: добавлены эффекты bleached/afro; rework error_alt_1.

Известные моменты/ToDo
- Иконки новых материалов указывают на img/materials/*.png — для некоторых могут быть временные заглушки.
- Рецепты alt‑карт удалены — возможна корректировка баланса стоимости оставшихся рецептов.
- В будущем: бейдж/фильтр “EXCLUSIVE” в инвентаре для rollable:false, лимитированные ивент‑карты, расширение “мутаций/версий” карт (golden/rainbow).


## Версия 0.2.1d

Новое
- Полная поддержка Multi‑Roll x10 (покупка, кнопка, авторолл, тексты).
- Автопроверка статуса саппортера при запуске (без лишних уведомлений).
- Баннер событий с таймером до окончания события (учёт дат начала/конца).

QoL (изменения)
- Отображаемая удача полностью совпадает с реальной (3 знака после запятой).
- Probability Analyzer в модалке показывает эффективный шанс с учётом реальной удачи.
- Раздел «Перерождение»: показывается потенциальный прирост удачи; в счётчик входят только коллекционные карты (без purchased_/garbage).
- Инвентарь показывает только доступные карты (учёт minPrestige, саппорта для diamond и ачивки для salt).
- Магазин: скидки отображаются с зачёркнутой базовой ценой; заголовок экипировки динамически учитывает лимит слотов (3/4).

Исправлено
- Удалён ломавший скрипт токен в game.js.
- Lucky Roll: введён минимальный порог (не ниже 2) — больше не срабатывает «каждый ролл».
- «Мусор» (garbage) больше не попадает в коллекцию/статистику.
- Синхронизирована формула удачи между UI и логикой ролла.
- bottomFeederRarities формируется по вероятности (а не по «хвосту массива») — корректная работа «Донной длани» и «Камня Алхимика».
- События: единая логика множителей; устранено дублирование переменных в ролле.
- Исправлены редкие падения: безопасные проверки UI, rollsByRarity в статистике, корректная работа с дефолтной статистикой.
- Данные карт:
  - blackhole: бонус за дубликат унифицирован до +0.01 и учитывается в формуле удачи.
  - space_alt_1: награда за дубликат 1042 (была 1420).
  - raven: награда за дубликат 460000 (было 360).
  - dionysia: исправлен путь к изображению.
  - space_alt_1 / space_alt_2: уникальные CSS‑классы для корректной подсветки.

Стабильность и оптимизация
- Нормализация сейва при загрузке (дефолты для всех ключевых полей; глубокая копия stats).
- Унифицированный notify() и безопасные вызовы UI.updateAll/… во всех местах.
- Пассивки пересчитываются из «самой редкой» версии семьи.
- AFK‑догон не дублирует механику «Алхимика» (исключены двойные осколки/усиления).
- Эффекты: централизовано управление overlay; scope‑очистка анимаций; проверки GSAP/PIXI и fallback без падений.
- Музыка: не автозапускается при громкости 0 и при ручной паузе; корректное переключение треков.

## Версия 0.1.6
* Добавлена новая механика механических эффектов.
* Добавлено 7(8) новых карт.
* Добавлено два предмета в магазин.
* Добавлена поддержка донатеров.

## Версия 0.1.5b
* Пофикшены некоторые баги и ошибки.
* Добавлено 4 вариации карт.
* Добавлены 5 новых визуальных эффектов.

## Версия 0.1.5
* Добавлена механика престижа
* Добавлено несколько новых престижных карт
* Добавлены вариации карт
* Исправлены ошибки
* QoL изменения
## Версия 0.1.4
* Исправлена английская локализация.
* Добавлено две новых редкости: Hybrid и Noble.
* Добавлен удобный тултип для удачи.
* Добавлен эффект для Jackpot.
* Добавлена механика Ядра Удачи.

## Версия 0.1.3a
* Добавлена английская локализация.

## Версия 0.1.3a
* Добавлено 4 новых редкости
* Статистика пользователя

## Версия 0.1.3
* Добавлено 4 новых редкости

## Версия 0.1.2
* Пофикшены многие баги (магазин, эффекты)
* Добавлена новая система эффектов
* Добавлено два новых артефакта
* Добавлено 3 новых редкости
* Система музыки переработана